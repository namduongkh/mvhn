"use strict";!function(){angular.module("Core",[]).config(["$interpolateProvider",function(t){t.startSymbol("{["),t.endSymbol("]}")}])}(),function(){function t(t,r){var o=this;o.loadBanner=function(){r.get(apiPath+"/api/product/productBanner").then(function(t){200==t.status&&(o.bannerList=t.data)})}}t.$inject=["$scope","$http"],angular.module("Core").controller("CoreController",t)}(),function(){function t(t){return{restrict:"AE",link:function(t,r,o){t.$watch(o.showLoading,function(t){t&&$(r).fadeIn("fast")})}}}t.$inject=["$parse"],angular.module("Core").directive("showLoading",t)}(),function(){function t(){return function(t,r,o){if(r&&(t=parseFloat(t)+parseFloat(r),o&&(t/=1e3)),0==t)return"0 đ";if(t){t=t.toString().split("").reverse();for(var n="",e=1;e<=t.length;e++)n+=e%3==0&&0!=e?t[e-1]+".":t[e-1];var i=n.split("").reverse();return"."==i[0]&&i.splice(0,1),o?i.join("").toString():i.join("")+" đ"}}}angular.module("Core").filter("vndCurrency",t)}(),function(){angular.module("Home",[]).config(["$interpolateProvider",function(t){t.startSymbol("{["),t.endSymbol("]}")}])}(),function(){function t(t,r,o,n){var e=this;e.orderCount=1,e.loadPage=function(){t.productList().then(function(t){200==t.status&&(e.productList=t.data,e.productBannerList=t.data.filter(function(t){if(t.banner)return t.intro=n.trustAsHtml(t.intro),t}),console.log(e.productBannerList))})},e.detailProduct=function(r){t.detailProduct({slug:r}).then(function(t){200==t.status&&(e.productDetail=t.data,e.productDetail.description=n.trustAsHtml(e.productDetail.description),e.productDetail.intro=n.trustAsHtml(e.productDetail.intro))})},e.changeOrderCount=function(t){t?e.orderCount++:e.orderCount--,e.orderCount=e.orderCount<1?1:e.orderCount,e.orderCount=e.orderCount>5?5:e.orderCount},e.order={},e.openOrder=function(){var r=e.productDetail.title,o=e.productDetail._id,n=e.productDetail.price*e.orderCount;r&&n&&o&&t.addCart({productId:o,count:e.orderCount}).then(function(t){200==t.status&&(window.location.href=window.settings.services.webUrl+"/gio-hang")})},e.confirmOrder=function(o){if(e.submitted=!0,!o||!e.order.user_address)return void r.error("Thông tin đặt hàng chưa hợp lệ!","Lỗi!");e.submitting=!0,t.orderProduct({product_name:e.order.product_name,product_count:e.orderCount,product_price:e.order.product_price,user_name:e.order.user_name,user_address:e.order.user_address,user_email:e.order.user_email,user_phone:e.order.user_phone,user_note:e.order.user_note}).then(function(t){200==t.status&&t.data?(r.success("Đặt hàng thành công, đơn hàng đang được xử lý","Thành công!"),$.magnificPopup.close()):r.error("Có lỗi xảy ra, liên hệ 01262346655 để được hỗ trợ!","Lỗi!"),e.submitted=!1,e.submitting=!1}).catch(function(){r.error("Có lỗi xảy ra, liên hệ 01262346655 để được hỗ trợ!","Lỗi!"),e.submitted=!1,e.submitting=!1})}}t.$inject=["ProductSvc","toastr","$http","$sce"],angular.module("Home").controller("HomeController",t)}(),function(){angular.module("Product",[]).config(["$interpolateProvider",function(t){t.startSymbol("{["),t.endSymbol("]}")}])}(),function(){function t(t,r,o,n){var e=this;e.tinymceOptions={plugins:"link image code",toolbar:"undo redo | fontselect fontsizeselect bold italic | alignleft aligncenter alignright | code",menubar:!1},e.createProduct=function(i){if(!i)return void r.error("Kiểm tra dữ liệu form");t.createProduct({title:e.form.title,price:e.form.price,description:e.form.description,slug:e.form.slug,imageLink:e.form.imageLink,bannerLink:e.form.bannerLink,intro:e.form.intro}).then(function(t){200==t.status?(r.success("Thêm sản phẩm thành công"),n(function(){window.location.href=o.settings.services.webUrl+"/portal/product/"+e.form.slug+"/edit"},2e3)):r.error("Xảy ra lỗi")}).catch(function(t){r.error("Xảy ra lỗi")})},e.updateProduct=function(o){if(!o)return void r.error("Kiểm tra dữ liệu form");t.updateProduct({productId:e.form._id,title:e.form.title,price:e.form.price,description:e.form.description,slug:e.form.slug,imageLink:e.form.imageLink,bannerLink:e.form.bannerLink,intro:e.form.intro}).then(function(t){200==t.status?(r.success("Sửa sản phẩm thành công"),e.form=t.data):r.error("Xảy ra lỗi")}).catch(function(t){r.error("Xảy ra lỗi")})},e.changeTitle=function(t){e.form.slug=slug(t).toLowerCase()},e.getListProduct=function(){t.productList().then(function(t){200==t.status&&(e.productList=t.data)})},e.deleteProduct=function(o,n){confirm("Bạn có chắc chắn muốn xóa sản phẩm này?")&&t.deleteProduct({product_id:o}).then(function(t){200==t.status&&t.data?(r.success("Đã xóa sản phẩm thành công!"),e.productList.splice(n,1)):r.error("Có lỗi xảy ra!")})},e.getProduct=function(r){r?t.detailProduct({slug:r}).then(function(t){200==t.status&&(e.form=t.data)}):window.location.href=o.settings.services.webUrl+"/portal/product"}}t.$inject=["ProductSvc","toastr","$window","$timeout"],angular.module("Product").controller("PortalProductController",t)}(),function(){function t(t){return{productList:function(){return t.get(apiPath+"/api/product/productList")},createProduct:function(r){return t.post(apiPath+"/api/product/createProduct",r)},updateProduct:function(r){return t.post(apiPath+"/api/product/updateProduct",r)},detailProduct:function(r){return t.post(apiPath+"/api/product/detailProduct",r)},orderProduct:function(r){return t.post(apiPath+"/api/product/order",r)},deleteProduct:function(r){return t.post(apiPath+"/api/product/deleteProduct",r)},addCart:function(r){return t.post(apiPath+"/api/product/addCart",r)}}}t.$inject=["$http"],angular.module("Product").service("ProductSvc",t)}(),function(){angular.module("User",[]).config(["$interpolateProvider",function(t){t.startSymbol("{["),t.endSymbol("]}")}])}(),function(){function t(t,r,o,n,e,i){var u=this;u.accountInfo={},u.loading=!0,u.getAccount=function(){t.account().then(function(t){200==t.status&&(u.accountInfo=t.data,t.data.roles.indexOf("admin")>-1&&(u.accountInfo.isAdmin=!0)),u.loading=!1})},u.getAccount(),u.login=function(){t.login({email:u.form.email,password:u.form.password}).then(function(t){r.put("token",t.data.token,{path:"/"}),window.location.reload()})},u.logout=function(){t.logout().then(function(t){r.remove("token"),window.location.reload()}).catch(function(t){r.remove("token"),window.location.reload()})},u.register=function(){t.register({email:u.form.email,password:u.form.password}).then(function(t){console.log("Resp",t),n.success("Đăng ký tài khoản thành công!","Thông báo!"),e(u.login,2e3)}).catch(function(t){var r=t.data;n.error(r.message||r,"Thông báo!")})},u.loadCart=function(){t.getCart().then(function(t){200==t.status&&(u.cart=t.data,u.updateCart())})},u.removeCartItem=function(r){confirm("Bạn có chắn chắc muốn xóa?")&&t.removeCartItem({id:r}).then(function(t){200==t.status&&(u.cart=t.data,u.updateCart())})},u.updateCart=function(){u.cart.allTotal=0,u.cart.products=u.cart.products.map(function(t){return t.total=Number(t.count)*Number(t.price),u.cart.allTotal+=t.total,t}),t.updateCart({cart:u.cart})},u.changeCount=function(t,r){r?t.count++:t.count--,t.count=t.count<1?1:t.count,t.count=t.count>5?5:t.count,u.updateCart()},u.confirmOrder=function(t){return u.submitted=!0,u.cart.products&&u.cart.products.length?t&&u.cart.user.user_address?(u.submitting=!0,void i.orderProduct(u.cart).then(function(t){200==t.status&&t.data?(u.orderSuccess="Đặt hàng thành công, đơn hàng sẽ được vận chuyển sớm đến bạn.",n.success(u.orderSuccess,"Thành công!"),u.cart={user:u.cart.user,products:[],allTotal:0},u.updateCart()):n.error("Có lỗi xảy ra, liên hệ 01262346655 để được hỗ trợ!","Lỗi!"),u.submitted=!1,u.submitting=!1}).catch(function(){n.error("Có lỗi xảy ra, liên hệ 01262346655 để được hỗ trợ!","Lỗi!"),u.submitted=!1,u.submitting=!1})):void n.error("Thông tin đặt hàng chưa hợp lệ!","Lỗi!"):void n.error("Chưa có sản phẩm nào trong giỏ!","Lỗi!")}}t.$inject=["UserService","$cookies","$rootScope","toastr","$timeout","ProductSvc"],angular.module("User").controller("UserController",t)}(),function(){function t(t){var r;return{login:function(r){return t({method:"POST",url:apiPath+"/api/user/login",data:r})},logout:function(r){return t({method:"GET",url:apiPath+"/api/user/logout"})},account:function(o){return r||(r=t({method:"GET",url:apiPath+"/api/user/account"})),r},register:function(r){return t({method:"POST",url:apiPath+"/api/user/register",data:r})},getCart:function(){return t({method:"GET",url:apiPath+"/api/user/getCart"})},removeCartItem:function(r){return t({method:"POST",url:apiPath+"/api/user/removeCartItem",data:r})},updateCart:function(r){return t({method:"POST",url:apiPath+"/api/user/updateCart",data:r})}}}t.$inject=["$http"],angular.module("User").service("UserService",t)}();var apiPath=window.location.origin;window.location.port&&(apiPath=window.settings.services.apiUrl),function(){var t=["Core","User","ngCookies","ngAnimate","toastr","angular-loading-bar","ui.tinymce","Product","ui.router","Home"];angular.module("HapiApp",t).config(["$httpProvider",function(t){t.defaults.withCredentials=!0}])}();